# 🎤 Голосовой AI-Ассистент - Архитектура и Обзор

## 📋 Содержание
1. [Общий обзор](#общий-обзор)
2. [Архитектура системы](#архитектура-системы)
3. [Компоненты](#компоненты)
4. [Поток данных](#поток-данных)
5. [Система команд](#система-команд)

## 🎯 Общий обзор

Голосовой AI-ассистент для Macro AI - это интеллектуальная система голосового управления, интегрированная с существующей платформой автоматизации macOS. Система обеспечивает:

- **🎤 Реальное распознавание речи** через микрофон
- **🤖 AI-диалоги** с использованием Gemini API
- **⚙️ Выполнение системных команд** (открытие приложений, скриншоты)
- **🗣️ Голосовые ответы** через динамики
- **⚡ Моментальный отклик** без перебивания

## 🏗️ Архитектура системы

```
┌─────────────────────────────────────────────────────────────────┐
│                    ГОЛОСОВОЙ AI-АССИСТЕНТ                       │
├─────────────────────────────────────────────────────────────────┤
│  🎤 ВХОДНОЙ СЛОЙ                                                │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐  │
│  │ Микрофон        │  │ Google Speech   │  │ Ключевые слова  │  │
│  │ (PyAudio)       │→ │ Recognition     │→ │ "Эй макро"      │  │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘  │
├─────────────────────────────────────────────────────────────────┤
│  🧠 ОБРАБОТКА И AI                                              │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐  │
│  │ AI Voice        │  │ Gemini API      │  │ Анализ команд   │  │
│  │ Integration     │→ │ (Диалоги)       │→ │ (Системные/AI)  │  │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘  │
├─────────────────────────────────────────────────────────────────┤
│  ⚙️ ИСПОЛНИТЕЛЬНЫЙ СЛОЙ                                         │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐  │
│  │ System          │  │ Macro           │  │ Fallback        │  │
│  │ Orchestrator    │  │ Generator       │  │ Commands        │  │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘  │
├─────────────────────────────────────────────────────────────────┤
│  🔊 ВЫХОДНОЙ СЛОЙ                                               │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐  │
│  │ TTS Engine      │  │ Приоритетная    │  │ Динамики        │  │
│  │ (pyttsx3/say)   │→ │ очередь речи    │→ │ (macOS say)     │  │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
```

## 🔧 Компоненты

### 1. **VoiceAssistant** (`src/voice/voice_assistant.py`)
- **Главный координатор** всей системы
- Управляет жизненным циклом ассистента
- Обрабатывает входящие голосовые команды
- Координирует взаимодействие между компонентами

### 2. **SpeechRecognition** (`src/voice/speech_recognition.py`)
- **Google Speech Recognition** для точного распознавания
- **Детекция ключевых слов**: "Эй макро", "Окей ассистент"
- **Калибровка микрофона** для лучшего качества
- **Обработка шума** и фильтрация

### 3. **AI Voice Integration** (`src/voice/ai_voice_integration.py`)
- **Gemini API интеграция** для диалогов
- **Анализ типа команд** (системные vs разговор)
- **База приложений** с переводом названий
- **Извлечение параметров** из AI ответов

### 4. **TextToSpeech** (`src/voice/text_to_speech.py`)
- **Приоритетная очередь** речи (high/normal/low)
- **Умное прерывание** для моментального отклика
- **Множественные движки**: pyttsx3, macOS say, fallback
- **Управление состоянием** речи

### 5. **SystemOrchestrator** (`src/voice/system_orchestrator.py`)
- **Выполнение системных команд** (открытие приложений)
- **Интеграция с macOS** через AppleScript
- **Безопасность выполнения** команд
- **Обработка ошибок** и логирование

## 🔄 Поток данных

```
🎤 Голос → 📝 Текст → 🧠 AI Анализ → ⚙️ Выполнение → 🗣️ Ответ

1. Микрофон захватывает звук
2. Google Speech Recognition → текст
3. Детекция ключевых слов ("Эй макро")
4. AI анализирует команду через Gemini
5. Определяется тип: системная команда или диалог
6. Выполнение через SystemOrchestrator или генерация ответа
7. TTS произносит результат с приоритетом
```

## 📊 Система команд

### **🔧 Системные команды (Предопределенные)**
```python
SYSTEM_COMMANDS = {
    "open_app": "Открытие приложений",
    "close_app": "Закрытие приложений", 
    "take_screenshot": "Создание скриншотов",
    "get_current_app": "Активное приложение",
    "list_processes": "Список процессов",
    "read_clipboard": "Чтение буфера обмена"
}
```

### **🤖 AI-генерируемые команды**
- **Обычный диалог**: "Как дела?", "Что ты умеешь?"
- **Сложные запросы**: "Создай макрос для открытия Gmail"
- **Контекстные команды**: Команды, требующие понимания контекста

### **⚡ Приоритеты выполнения**
1. **HIGH**: Новые голосовые команды (прерывают речь)
2. **NORMAL**: Обычные ответы и подтверждения
3. **LOW**: Фоновые уведомления

## 🚀 Ключевые особенности

### **⚡ Моментальный отклик**
- Прерывание текущей речи для новых команд
- Приоритетная очередь сообщений
- Умная очистка низкоприоритетных задач

### **🧠 Умный анализ команд**
- База из 50+ приложений с переводом названий
- Извлечение параметров из AI ответов
- Fallback логика без AI

### **🔊 Продвинутый TTS**
- Множественные движки для надежности
- Управление прерываниями
- Очередь с приоритетами

### **🛡️ Надежность**
- Обработка ошибок на всех уровнях
- Fallback режимы для каждого компонента
- Graceful degradation при сбоях

---

**Следующие разделы:**
- [02-command-system.md](02-command-system.md) - Подробная система команд
- [03-speed-optimization.md](03-speed-optimization.md) - Оптимизация скорости
- [04-user-guide.md](04-user-guide.md) - Руководство пользователя
