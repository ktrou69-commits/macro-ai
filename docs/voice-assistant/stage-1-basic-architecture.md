# üèóÔ∏è –≠—Ç–∞–ø 1: –ë–∞–∑–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** 1-2 –Ω–µ–¥–µ–ª–∏  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í—ã—Å–æ–∫–∏–π  
**–°—Ç–∞—Ç—É—Å:** –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

## üéØ –¶–µ–ª–∏ —ç—Ç–∞–ø–∞

1. –°–æ–∑–¥–∞—Ç—å –±–∞–∑–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–∞–ø–æ–∫ –¥–ª—è –Ω–æ–≤—ã—Ö –º–æ–¥—É–ª–µ–π
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –º–∞–∫—Ä–æ—Å–æ–≤
3. –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ –≤ DSL –ø–∞—Ä—Å–µ—Ä
4. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º –±–µ–∑ –ø–æ–ª–æ–º–æ–∫

## üìÅ –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–∞–ø–æ–∫

### –®–∞–≥ 1.1: –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–µ –ø–∞–ø–∫–∏

```bash
mkdir -p src/voice
mkdir -p src/system  
mkdir -p src/memory
```

### –®–∞–≥ 1.2: –°–æ–∑–¥–∞—Ç—å __init__.py —Ñ–∞–π–ª—ã

```python
# src/voice/__init__.py
"""
–ú–æ–¥—É–ª–∏ –¥–ª—è –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞ –∏ –≤—ã–≤–æ–¥–∞
"""

# src/system/__init__.py  
"""
–°–∏—Å—Ç–µ–º–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏
"""

# src/memory/__init__.py
"""
–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∏ –ø–∞–º—è—Ç—å—é –º–∞–∫—Ä–æ—Å–æ–≤
"""
```

## üß† –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º

### –®–∞–≥ 1.3: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å state_manager.py

**–§–∞–π–ª:** `src/memory/state_manager.py`

**–û—Å–Ω–æ–≤–Ω—ã–µ –∫–ª–∞—Å—Å—ã:**
- `MacroState` - —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –º–∞–∫—Ä–æ—Å–∞
- `StateManager` - –º–µ–Ω–µ–¥–∂–µ—Ä –≤—Å–µ—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π
- `StateStorage` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–∑–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π

**–ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
```python
class MacroState:
    def __init__(self, session_id, atlas_file):
        self.session_id = session_id
        self.atlas_file = atlas_file
        self.current_step = 0
        self.completed_steps = []
        self.pending_steps = []
        self.variables = {}
        self.last_error = None
        self.start_time = datetime.now()
        
    def save_step_result(self, step_num, result):
        """–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —à–∞–≥–∞"""
        
    def get_context_for_ai(self):
        """–ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –ò–ò"""
        
    def can_resume(self):
        """–ú–æ–∂–Ω–æ –ª–∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ"""
```

### –®–∞–≥ 1.4: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å macro_sequence.py

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º —Ñ–∞–π–ª–µ:**
- –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞
- –î–æ–±–∞–≤–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —à–∞–≥–∞
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

**–ü—Ä–∏–º–µ—Ä –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:**
```python
# –í macro_sequence.py –¥–æ–±–∞–≤–∏—Ç—å:
from src.memory.state_manager import StateManager

class MacroSequence:
    def __init__(self):
        self.state_manager = StateManager()
        
    def execute_step(self, step):
        # –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
        result = self._execute_step_logic(step)
        
        # –ù–û–í–û–ï: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
        self.state_manager.save_step_result(
            step_num=self.current_step,
            result=result
        )
```

## üîß –ü–æ–¥–¥–µ—Ä–∂–∫–∞ @system –∫–æ–º–∞–Ω–¥

### –®–∞–≥ 1.5: –†–∞—Å—à–∏—Ä–∏—Ç—å atlas_dsl_parser.py

**–ù–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è DSL:**
```atlas
# –°–∏—Å—Ç–µ–º–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã (—Å–∫—Ä—ã—Ç—ã–µ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
@system open_app "Chrome"
@system close_app "Chrome"  
@system focus_window "Chrome"
@system take_screenshot
@system copy_to_clipboard "text"

# –û–±—ã—á–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã (–≤–∏–¥–∏–º—ã–µ)
click Button
wait 2s
type "hello"
```

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ø–∞—Ä—Å–µ—Ä–µ:**
```python
# –í atlas_dsl_parser.py –¥–æ–±–∞–≤–∏—Ç—å:
def parse_system_command(self, line):
    """–ü–∞—Ä—Å–∏–Ω–≥ @system –∫–æ–º–∞–Ω–¥"""
    if line.startswith('@system'):
        command_part = line[8:].strip()  # –£–±–∏—Ä–∞–µ–º '@system '
        return {
            'action': 'system_command',
            'command': command_part,
            'hidden': True  # –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤ UI
        }
```

### –®–∞–≥ 1.6: –°–æ–∑–¥–∞—Ç—å –±–∞–∑–æ–≤—ã–π system_orchestrator.py

**–§–∞–π–ª:** `src/system/system_orchestrator.py`

**–û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏:**
```python
class SystemOrchestrator:
    def choose_execution_strategy(self, command, context):
        """
        –í—ã–±–æ—Ä —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:
        1. DOM (–µ—Å–ª–∏ –≤–µ–±-–∫–æ–Ω—Ç–µ–∫—Å—Ç)
        2. System API (–µ—Å–ª–∏ —Å–∏—Å—Ç–µ–º–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞)  
        3. CV (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π fallback)
        """
        
    def execute_system_command(self, command):
        """–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω–æ–π –∫–æ–º–∞–Ω–¥—ã"""
        
    def is_system_command(self, command):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –∫–æ–º–∞–Ω–¥–∞ —Å–∏—Å—Ç–µ–º–Ω–æ–π"""
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### –®–∞–≥ 1.7: –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç—ã

**–§–∞–π–ª:** `tests/test_stage1_basic.py`

```python
def test_state_manager_creation():
    """–¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π"""
    
def test_system_command_parsing():
    """–¢–µ—Å—Ç –ø–∞—Ä—Å–∏–Ω–≥–∞ @system –∫–æ–º–∞–Ω–¥"""
    
def test_macro_sequence_integration():
    """–¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å macro_sequence.py"""
```

## üìã –ß–µ–∫-–ª–∏—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

- [ ] –°–æ–∑–¥–∞–Ω—ã –ø–∞–ø–∫–∏ src/voice/, src/system/, src/memory/
- [ ] –°–æ–∑–¥–∞–Ω—ã __init__.py —Ñ–∞–π–ª—ã
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω MacroState –∫–ª–∞—Å—Å
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω StateManager –∫–ª–∞—Å—Å  
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω StateManager —Å macro_sequence.py
- [ ] –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ @system –∫–æ–º–∞–Ω–¥ –≤ atlas_dsl_parser.py
- [ ] –°–æ–∑–¥–∞–Ω –±–∞–∑–æ–≤—ã–π SystemOrchestrator
- [ ] –ù–∞–ø–∏—Å–∞–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è –±–∞–∑–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## üîó –°–≤—è–∑–∏ —Å –¥—Ä—É–≥–∏–º–∏ —ç—Ç–∞–ø–∞–º–∏

- **–≠—Ç–∞–ø 2:** –ë—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SystemOrchestrator –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥
- **–≠—Ç–∞–ø 3:** –ë—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å StateManager –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–µ—Å—Å–∏–π
- **–≠—Ç–∞–ø 4:** GUI –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–∑ StateManager

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:** –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º–∏
2. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** StateManager –Ω–µ –¥–æ–ª–∂–µ–Ω –∑–∞–º–µ–¥–ª—è—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
3. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** @system –∫–æ–º–∞–Ω–¥—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω—ã whitelist'–æ–º
4. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ö–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å unit-—Ç–µ—Å—Ç—ã

## üìö –°–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –±–∞–∑–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ [–≠—Ç–∞–ø—É 2: –°–∏—Å—Ç–µ–º–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã](./stage-2-system-commands.md)
