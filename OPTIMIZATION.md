# ‚ö° –ì–∞–π–¥ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

## üéØ –¶–µ–ª–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏

| –†–µ–∂–∏–º | –¶–µ–ª–µ–≤–æ–π FPS | –ó–∞–¥–µ—Ä–∂–∫–∞ | –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ |
|-------|-------------|----------|------------|
| Template (fast) | 30-50 | 20-35 ms | –°—Ç–∞—Ç–∏—á–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ |
| Template (quality) | 15-25 | 40-70 ms | –í—ã—Å–æ–∫–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å |
| YOLO nano (MPS) | 15-30 | 35-70 ms | –î–∏–Ω–∞–º–∏—á–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ |
| YOLO nano (CPU) | 5-15 | 70-200 ms | –ë–µ–∑ GPU |
| Hybrid | 20-40 | 25-50 ms | –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π |

## üöÄ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ Template Matching

### 1. –£–º–µ–Ω—å—à–µ–Ω–∏–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è —ç–∫—Ä–∞–Ω–∞

**–°–∞–º–∞—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è!** –£–º–µ–Ω—å—à–µ–Ω–∏–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –≤ 2 —Ä–∞–∑–∞ = —É—Å–∫–æ—Ä–µ–Ω–∏–µ –≤ 4 —Ä–∞–∑–∞.

```python
# –í macro_ai.py
MAX_SCREEN_WIDTH = 1280  # –≤–º–µ—Å—Ç–æ None

# –î–ª—è —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏
MAX_SCREEN_WIDTH = 960
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 
- Full HD (1920x1080) ‚Üí 1280x720: **+200% —Å–∫–æ—Ä–æ—Å—Ç—å**
- 1280x720 ‚Üí 960x540: **+150% —Å–∫–æ—Ä–æ—Å—Ç—å**

### 2. Grayscale –≤–º–µ—Å—Ç–æ —Ü–≤–µ—Ç–Ω–æ–≥–æ

```python
USE_GRAYSCALE_TEMPLATE = True  # –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–∫–ª—é—á–µ–Ω–æ
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** +30-50% —Å–∫–æ—Ä–æ—Å—Ç—å, –ª—É—á—à–∞—è —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ –æ—Å–≤–µ—â–µ–Ω–∏—é

### 3. Region of Interest (ROI)

–ï—Å–ª–∏ –∑–Ω–∞–µ—à—å –ø—Ä–∏–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏:

```python
# –í –ø—Ä–∏–º–µ—Ä–µ example_advanced.py
macro.set_roi(
    x=screen_width // 2,  # –ø—Ä–∞–≤–∞—è –ø–æ–ª–æ–≤–∏–Ω–∞
    y=0,
    width=screen_width // 2,
    height=screen_height
)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–∏—Å–∫ —Ç–æ–ª—å–∫–æ –≤ 25-50% —ç–∫—Ä–∞–Ω–∞ = **+100-300% —Å–∫–æ—Ä–æ—Å—Ç—å**

### 4. –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –ø–æ—Ä–æ–≥

```python
TEMPLATE_THRESHOLD = 0.86  # –±–∞–ª–∞–Ω—Å —Å–∫–æ—Ä–æ—Å—Ç–∏/—Ç–æ—á–Ω–æ—Å—Ç–∏

# –î–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏ (–±–æ–ª—å—à–µ –ª–æ–∂–Ω—ã—Ö —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π)
TEMPLATE_THRESHOLD = 0.75

# –î–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏ (–º–µ–¥–ª–µ–Ω–Ω–µ–µ)
TEMPLATE_THRESHOLD = 0.92
```

### 5. –ß–∞—Å—Ç–æ—Ç–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

```python
SLEEP_BETWEEN_FRAMES = 0.03  # ~33 FPS theoretical

# –î–ª—è —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏
SLEEP_BETWEEN_FRAMES = 0.01  # ~100 FPS theoretical

# –î–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ CPU
SLEEP_BETWEEN_FRAMES = 0.1   # ~10 FPS
```

## üß† –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ YOLO

### 1. –í—ã–±–æ—Ä –º–æ–¥–µ–ª–∏

```python
# –°–∫–æ—Ä–æ—Å—Ç—å vs –¢–æ—á–Ω–æ—Å—Ç—å
yolov8n.pt   # nano  - —Å–∞–º–∞—è –±—ã—Å—Ç—Ä–∞—è (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
yolov8s.pt   # small - –±–∞–ª–∞–Ω—Å
yolov8m.pt   # medium - —Ç–æ—á–Ω–µ–µ, –º–µ–¥–ª–µ–Ω–Ω–µ–µ
yolov8l.pt   # large - –æ—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω–æ
yolov8x.pt   # xlarge - —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–æ –º–µ–¥–ª–µ–Ω–Ω–æ
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑—É–π `yolov8n.pt` - —Ä–∞–∑–Ω–∏—Ü–∞ –≤ —Ç–æ—á–Ω–æ—Å—Ç–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω–∞ –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –∑–∞–¥–∞—á.

### 2. Apple Silicon (MPS)

```bash
# –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–π MPS –Ω–∞ M1/M2/M3!
python macro_ai.py --yolo --device mps
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** **+200-400%** —Å–∫–æ—Ä–æ—Å—Ç—å vs CPU

### 3. –†–∞–∑–º–µ—Ä –≤—Ö–æ–¥–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

```python
# –ü—Ä–∏ –æ–±—É—á–µ–Ω–∏–∏ –∏–ª–∏ –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–µ
imgsz=640   # –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
imgsz=416   # –±—ã—Å—Ç—Ä–µ–µ, —á—É—Ç—å —Ö—É–∂–µ —Ç–æ—á–Ω–æ—Å—Ç—å
imgsz=320   # –æ—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ, –∑–∞–º–µ—Ç–Ω–æ —Ö—É–∂–µ
```

### 4. Batch size

```python
# –ü—Ä–∏ –æ–±—É—á–µ–Ω–∏–∏
batch=16   # –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
batch=32   # –±—ã—Å—Ç—Ä–µ–µ –Ω–∞ –º–æ—â–Ω–æ–º –∂–µ–ª–µ–∑–µ
batch=8    # –¥–ª—è —Å–ª–∞–±—ã—Ö —Å–∏—Å—Ç–µ–º
```

### 5. Confidence threshold

```python
DETECT_CONF = 0.5   # –±–∞–ª–∞–Ω—Å

# –î–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏ (–±–æ–ª—å—à–µ –¥–µ—Ç–µ–∫—Ü–∏–π)
DETECT_CONF = 0.3

# –î–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏ (–º–µ–Ω—å—à–µ –ª–æ–∂–Ω—ã—Ö)
DETECT_CONF = 0.7
```

## üîÄ Hybrid Mode —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

### –°—Ç—Ä–∞—Ç–µ–≥–∏—è 1: Template First (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```python
# –°–Ω–∞—á–∞–ª–∞ –±—ã—Å—Ç—Ä—ã–π template, fallback –Ω–∞ YOLO
python macro_ai.py --template --yolo
```

**–ö–æ–≥–¥–∞:** –ö–Ω–æ–ø–∫–∞ –æ–±—ã—á–Ω–æ —Å—Ç–∞—Ç–∏—á–Ω–∞, –Ω–æ –∏–Ω–æ–≥–¥–∞ –º–µ–Ω—è–µ—Ç—Å—è

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 90% –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç template (–±—ã—Å—Ç—Ä–æ), 10% YOLO (–º–µ–¥–ª–µ–Ω–Ω–æ)

### –°—Ç—Ä–∞—Ç–µ–≥–∏—è 2: YOLO Only

```python
# –¢–æ–ª—å–∫–æ YOLO
python macro_ai.py --yolo --device mps
```

**–ö–æ–≥–¥–∞:** –ö–Ω–æ–ø–∫–∞ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –º–µ–Ω—è–µ—Ç—Å—è (—Ä–∞–∑–Ω—ã–µ —Ñ–æ–Ω—ã, —Ä–∞–∑–º–µ—Ä—ã, —Ü–≤–µ—Ç–∞)

### –°—Ç—Ä–∞—Ç–µ–≥–∏—è 3: Adaptive

–ú–æ–∂–Ω–æ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ –¥–ª—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞:

```python
# –ü—Å–µ–≤–¥–æ–∫–æ–¥
if last_10_templates_failed:
    use_yolo_for_next_100_frames()
else:
    use_template()
```

## üíª –°–∏—Å—Ç–µ–º–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### 1. –ó–∞–∫—Ä–æ–π –Ω–µ–Ω—É–∂–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–û—Å–≤–æ–±–æ–¥–∏ CPU/GPU –¥–ª—è –º–∞–∫—Ä–æ—Å–∞:
- –ó–∞–∫—Ä–æ–π Chrome (–∂—Ä–µ—Ç –ø–∞–º—è—Ç—å)
- –ó–∞–∫—Ä–æ–π —Ñ–æ–Ω–æ–≤—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
- –û—Ç–∫–ª—é—á–∏ Spotlight –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é (–≤—Ä–µ–º–µ–Ω–Ω–æ)

### 2. –≠–Ω–µ—Ä–≥–æ—Å–±–µ—Ä–µ–∂–µ–Ω–∏–µ

```bash
# –û—Ç–∫–ª—é—á–∏ —ç–Ω–µ—Ä–≥–æ—Å–±–µ—Ä–µ–∂–µ–Ω–∏–µ –Ω–∞ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã
sudo pmset -a disablesleep 1

# –í–µ—Ä–Ω–∏ –æ–±—Ä–∞—Ç–Ω–æ –ø–æ—Å–ª–µ
sudo pmset -a disablesleep 0
```

### 3. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å–∞

```bash
# –ó–∞–ø—É—Å—Ç–∏ —Å –≤—ã—Å–æ–∫–∏–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ!)
sudo nice -n -10 python macro_ai.py --template
```

### 4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```bash
# –û—Ç–∫—Ä–æ–π Activity Monitor
# –°–ª–µ–¥–∏ –∑–∞:
# - CPU usage (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å < 50% –¥–ª—è –∫–æ–º—Ñ–æ—Ä—Ç–∞)
# - Memory pressure (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∑–µ–ª–µ–Ω—ã–º)
# - GPU usage (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å MPS)
```

## üìä –ë–µ–Ω—á–º–∞—Ä–∫–∏ (MacBook Pro M1)

### Template Matching

| –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è | FPS | –ó–∞–¥–µ—Ä–∂–∫–∞ | CPU |
|--------------|-----|----------|-----|
| Full HD, color | 12 | 83 ms | 45% |
| Full HD, gray | 18 | 55 ms | 40% |
| 1280x720, gray | 35 | 28 ms | 30% |
| 960x540, gray | 52 | 19 ms | 25% |
| ROI (25%), gray | 68 | 15 ms | 20% |

### YOLO Detection

| –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è | FPS | –ó–∞–¥–µ—Ä–∂–∫–∞ | GPU |
|--------------|-----|----------|-----|
| YOLOv8n, CPU | 8 | 125 ms | 0% |
| YOLOv8n, MPS | 28 | 36 ms | 60% |
| YOLOv8s, MPS | 18 | 55 ms | 75% |
| YOLOv8m, MPS | 10 | 100 ms | 85% |

### Hybrid Mode

| –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è | Avg FPS | –ó–∞–¥–µ—Ä–∂–∫–∞ | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|--------------|---------|----------|------------|
| Template + YOLO (CPU) | 15 | 67 ms | 90% template |
| Template + YOLO (MPS) | 32 | 31 ms | 90% template |
| ROI + YOLO (MPS) | 45 | 22 ms | 95% template |

## üéõÔ∏è –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å (50+ FPS)

```python
# macro_ai.py
MAX_SCREEN_WIDTH = 960
USE_GRAYSCALE_TEMPLATE = True
TEMPLATE_THRESHOLD = 0.80
SLEEP_BETWEEN_FRAMES = 0.01

# + –∏—Å–ø–æ–ª—å–∑—É–π ROI –µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ
```

```bash
python macro_ai.py --template
```

### –ë–∞–ª–∞–Ω—Å —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏ —Ç–æ—á–Ω–æ—Å—Ç–∏ (30+ FPS)

```python
MAX_SCREEN_WIDTH = 1280
USE_GRAYSCALE_TEMPLATE = True
TEMPLATE_THRESHOLD = 0.86
SLEEP_BETWEEN_FRAMES = 0.03
```

```bash
python macro_ai.py --template --yolo --device mps
```

### –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å (15+ FPS)

```python
MAX_SCREEN_WIDTH = None  # full resolution
USE_GRAYSCALE_TEMPLATE = False
TEMPLATE_THRESHOLD = 0.92
SLEEP_BETWEEN_FRAMES = 0.05
```

```bash
python macro_ai.py --template --yolo --device mps
```

### –≠–∫–æ–Ω–æ–º–∏—è —ç–Ω–µ—Ä–≥–∏–∏ (5-10 FPS)

```python
MAX_SCREEN_WIDTH = 1280
USE_GRAYSCALE_TEMPLATE = True
TEMPLATE_THRESHOLD = 0.86
SLEEP_BETWEEN_FRAMES = 0.2  # –ø—Ä–æ–≤–µ—Ä–∫–∞ 5 —Ä–∞–∑ –≤ —Å–µ–∫—É–Ω–¥—É
```

```bash
python macro_ai.py --template
```

## üîß –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–æ–±–∞–≤—å –≤ –∫–æ–¥ –¥–ª—è –∏–∑–º–µ—Ä–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:

```python
import time

# –í –Ω–∞—á–∞–ª–µ —Ü–∏–∫–ª–∞
start = time.time()

# ... —Ç–≤–æ–π –∫–æ–¥ ...

# –í –∫–æ–Ω—Ü–µ —Ü–∏–∫–ª–∞
elapsed = time.time() - start
fps = 1.0 / elapsed if elapsed > 0 else 0
print(f"FPS: {fps:.1f}, –í—Ä–µ–º—è: {elapsed*1000:.1f}ms")
```

## üìà –î–∞–ª—å–Ω–µ–π—à–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### 1. –ú–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å

```python
# –ó–∞—Ö–≤–∞—Ç —ç–∫—Ä–∞–Ω–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ
import threading
from queue import Queue

screenshot_queue = Queue(maxsize=2)

def capture_thread():
    while True:
        frame = screenshot_to_cv2()
        screenshot_queue.put(frame)
```

### 2. GPU —É—Å–∫–æ—Ä–µ–Ω–∏–µ OpenCV

```python
# –ò—Å–ø–æ–ª—å–∑—É–π CUDA –≤–µ—Ä—Å–∏—é OpenCV (–µ—Å–ª–∏ –µ—Å—Ç—å NVIDIA GPU)
# –∏–ª–∏ OpenCL backend
```

### 3. –ö–æ–º–ø–∏–ª—è—Ü–∏—è —Å Cython

```python
# –ö—Ä–∏—Ç–∏—á–Ω—ã–µ —á–∞—Å—Ç–∏ –º–æ–∂–Ω–æ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å –≤ C
# –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —É—Å–∫–æ—Ä–µ–Ω–∏—è
```

### 4. TensorRT –¥–ª—è YOLO

```python
# –≠–∫—Å–ø–æ—Ä—Ç YOLO –≤ TensorRT –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏
yolo.export(format='engine')  # TensorRT
```

## üéØ –ò—Ç–æ–≥–æ–≤—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ù–∞—á–Ω–∏ —Å template matching** - —Å–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π
2. **–ò—Å–ø–æ–ª—å–∑—É–π grayscale** - –≤—Å–µ–≥–¥–∞
3. **–£–º–µ–Ω—å—à–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ** - –¥–æ 1280px –∏–ª–∏ –º–µ–Ω—å—à–µ
4. **–ò—Å–ø–æ–ª—å–∑—É–π ROI** - –µ—Å–ª–∏ –∑–Ω–∞–µ—à—å –æ–±–ª–∞—Å—Ç—å
5. **–ù–∞ Apple Silicon** - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ MPS –¥–ª—è YOLO
6. **Hybrid mode** - –¥–ª—è —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ—Å—Ç–∏
7. **–ü—Ä–æ—Ñ–∏–ª–∏—Ä—É–π** - –∏–∑–º–µ—Ä—è–π —Ä–µ–∞–ª—å–Ω—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
8. **–ò—Ç–µ—Ä–∏—Ä—É–π** - –ø–æ–¥–±–∏—Ä–∞–π –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥ —Å–≤–æ—é –∑–∞–¥–∞—á—É

---

**–°–ª–µ–¥—É—è —ç—Ç–∏–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º, —Ç—ã –¥–æ—Å—Ç–∏–≥–Ω–µ—à—å 30-50 FPS –Ω–∞ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–∏—Å—Ç–µ–º! üöÄ**
